#!/bin/sh
#
# PROVIDE: clamav-milter
# REQUIRE: LOGIN clamd
# BEFORE: mail 
# KEYWORD: shutdown

clamav_milter_enable="${clamav_milter_enable:=NO}"
clamav_milter_socket=${clamav_milter_socket:="%%CL_MILTER_SOCKET%%"}
clamav_milter_flags=${clamav_milter_flags:="--postmaster-only --local --outgoing --timeout=0 --max-children=50"}

. /etc/rc.subr

name=clamav_milter
rcvar=`set_rcvar`

command="%%PREFIX%%/sbin/clamav-milter"
pidfile="%%CL_RUN_DIR%%/clamav-milter.pid"
required_dirs="%%CL_DB_DIR%%"
required_files="%%PREFIX%%/etc/clamav/clamd.conf"

start_precmd=start_precmd

start_precmd()
{
	if [ -S "$clamav_milter_socket" ]; then
		warn "Stale socket $clamav_milter_socket removed."
		rm "$clamav_milter_socket"
	fi
	rc_flags="--pidfile ${pidfile} ${flags:-$clamav_milter_flags} $clamav_milter_socket"
}

load_rc_config $name

run_rc_command "$1"
#EOF
