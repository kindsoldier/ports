#!/bin/sh

set -x

CUPS_RUNDIR="%%CUPS_RUNDIR%%"
CUPS_LOGDIR="%%CUPS_LOGDIR%%"
CUPS_CACHEDIR="%%CUPS_CACHEDIR%%"
CUPS_SPOOLDIR="%%CUPS_SPOOLDIR%%"

CUPS_STATEDIR="%%CUPS_STATEDIR%%"
CUPS_REQUESTSDIR="%%CUPS_REQUESTSDIR%%"

CUPS_CONFDIR="%%CUPS_CONFDIR%%"

CUPS_OWNER="%%CUPS_OWNER%%"
CUPS_GROUP="%%CUPS_GROUP%%"

CUPS_OWNERID="%%CUPS_OWNERID%%"
CUPS_GROUPID="%%CUPS_GROUPID%%"

CUPS_NAME="cups"
CUPS_SHELL="/usr/bin/nologin"
CUPS_HOMEDIR="/notexist"

case $2 in 
    PRE-INSTALL)
	pw group add ${CUPS_GROUP} -g ${CUPS_GROUPID}
	pw group show ${CUPS_GROUP}
	pw user add ${CUPS_OWNER} -g ${CUPS_GROUP} \
		-d ${CUPS_HOMEDIR} -s ${CUPS_SHELL} -u ${CUPS_OWNERID} -c "${CUPS_NAME}"
	pw user show ${CUPS_OWNER}
	pw group mod ${CUPS_GROUP} -M ${CUPS_OWNER}
	pw group show ${CUPS_GROUP}

	install -d -m 755 -g ${CUPS_GROUP} ${CUPS_CONFDIR}
	install -d -m 755 -g ${CUPS_GROUP} ${CUPS_CONFDIR}/interfaces
	install -d -m 755 -g ${CUPS_GROUP} ${CUPS_CONFDIR}/ppd
	install -d -m 700 -g ${CUPS_GROUP} ${CUPS_CONFDIR}/ssl
	install -d -m 755 ${CUPS_STATEDIR}
	install -d -m 511 -o ${CUPS_OWNER} -g ${CUPS_GROUP} ${CUPS_STATEDIR}/certs
	install -d -m 755 ${CUPS_LOGDIR}
	install -d -m 710 -g ${CUPS_GROUP} ${CUPS_REQUESTSDIR}
	install -d -m 1770 -g ${CUPS_GROUP} ${CUPS_REQUESTSDIR}/tmp
	install -d -m 775 -g ${CUPS_GROUP} ${CUPS_CACHEDIR}

	install -d -m 775 -o root -g wheel ${PKG_PREFIX}/libexec/cups/driver

	chown -R ${CUPS_OWNER}:${CUPS_GROUP} ${CUPS_SPOOLDIR}
	chown -R g+w ${CUPS_SPOOLDIR}

	install -d ${CUPS_CACHEDIR}
	chown root:${CUPS_GROUP} ${CUPS_CACHEDIR}
	;;
    POST-INSTALL)
	;;
esac
exit 0
#EOF
