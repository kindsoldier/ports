#
# $Id$
#
PORTNAME?=	ioquake3
DISTVERSION=	1.36
CATEGORIES=	games
MASTER_SITES=	http://ioquake3.org/files/${DISTVERSION}/
EXTRACT_SUFX=	.zip

MAINTAINER=	kamikaze@bsdforen.de
COMMENT=	Cleaned-up and enhanced version of Quake 3

#LIB_DEPENDS+=	libopenal.so:media/libopenal
LIB_DEPENDS+=	libvorbis.so:media/libvorbis
LIB_DEPENDS+=	libopus.so:media/libopus
LIB_DEPENDS+=	libcurl.so:net/libcurl
LIB_DEPENDS+=	libGL.so:graph/libmesa

USES=		gmake

HOMEPATH=	/.${PORTNAME}
Q3BASE=	baseq3 	missionpack
Q3GAMELIBS=	cgame qagame ui

Q3DIR=	${LOCALBASE}/share/quake3/
IOQ3ARCH=	${ARCH}

MAKE_ARGS+=	DEFAULT_BASEDIR="${Q3DIR}"
MAKE_ARGS+=	DEFAULT_LIBDIR="${PREFIX}/${LIBDIR}"
MAKE_ARGS+=	HOMEPATH="${HOMEPATH}"
#MAKE_ARGS+=	VERSION="${Q3ENGINEVER}"
MAKE_ARGS+=	ARCH="${IOQ3ARCH}"
MAKE_ARGS+=	TOOLS_CC="${CC}"
#MAKE_ARGS+=	USE_LOCAL_HEADERS=0

ALL_TARGET=	release

LIBDIR=		lib/${PORTNAME}${PKGNAMESUFFIX}
DOCSDIR=	share/doc/${PORTNAME}${PKGNAMESUFFIX}
BUILDDIR=	${WRKSRC}/build/${ALL_TARGET}-freebsd-${IOQ3ARCH}
BINSUFFIX=

Q3CLIENT+=	ioquake3
Q3SERVER+=	ioq3ded

Q3TOOLS+=	q3asm
Q3TOOLS+=	q3cpp
Q3TOOLS+=	q3lcc
Q3TOOLS+=	q3rcc


Q3ICON=	${PREFIX}/share/pixmaps/quake3.xpm

ONLY_FOR_ARCHS=	amd64 i386

.include <bsd.port.options.mk>

MAKE_ARGS+=	BUILD_CLIENT=1
MAKE_ARGS+=	BUILD_SERVER=1
MAKE_ARGS+=	USE_CURL=1 USE_CURL_DLOPEN=0
#MAKE_ARGS+=	USE_CURL=0
MAKE_ARGS+=	USE_OPENAL=1 USE_OPENAL_DLOPEN=0
#MAKE_ARGS+=	USE_OPENAL=0
MAKE_ARGS+=	USE_CODEC_VORBIS=1

MAKE_ARGS+=	USE_CODEC_OPUS=1 USE_INTERNAL_OPUS=0
#MAKE_ARGS+=	USE_CODEC_OPUS=0
MAKE_ARGS+=	USE_INTERNAL_OGG=0
#MAKE_ARGS+=	USE_MUMBLE=1
MAKE_ARGS+=	BUILD_GAME_SO=0

MAKE_ARGS+=	BUILD_CLIENT_SMP=0
#MAKE_ARGS+=	USE_RENDERER_DLOPEN=0


do-install:
	${MKDIR} ${STAGEDIR}${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/build/release-freebsd-${ARCH}/ioq3ded.${ARCH} \
	    ${STAGEDIR}${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/build/release-freebsd-${ARCH}/ioquake3.${ARCH} \
	    ${STAGEDIR}${PREFIX}/bin


.include <bsd.port.mk>
#EOF
